var __spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))};define("clientinst_xls",["require","exports"],function(n,t){function si(){function n(n,t){typeof i[n]=="undefined"&&(i[n]=t)}_w.ClientInstConfig||(_w.ClientInstConfig={});i=ClientInstConfig;n("flushInterval",5e3);n("retryInterval",1e3);n("maxStorageUse",5e5);n("maxBatchSize",1e5);n("queueDumpInterval",500);n("waitForPageInfo",!1);n("pageInfoTimeout",5e3);n("logUploadCapSizeInChar",15728640*.5);n("logUploadCapIntervalInDays",30);n("isInstrumentationEnabled",!0);n("maxDirectErrors",3)}function yt(){ut=0;p=_G.ST?_G.ST.getTime():0}function f(n,t,r,u){var f,h,e,o;if(i.isInstrumentationEnabled)if(f={errorType:n,failCount:t},d(f),u){vt++;vt>i.maxDirectErrors&&(f.errorType="Overloaded",i.isInstrumentationEnabled=!1);h={impressionGuid:r,previousImpressionGuid:null,timestamp:(new Date).getTime(),type:s.EVENT,data:{eventType:rt,eventData:f}};e=et([h],[]);try{ht(e)||(o=sj_gx(),o.open("POST",_G.XLS,!0),o.send(e))}catch(c){throw c;}}else st(rt,f,null,null,null,r,null,null)}function hi(){function t(){o||(o=function(){});pt();f("PageInfoTimedOut",0,_G.IG)}si();yt();typeof h!="undefined"&&h.bind&&h.bind("ajax.unload",yt);try{u=_w.localStorage;r.initialize()}catch(e){}var n=null;i.waitForPageInfo&&(n=sb_st(t,i.pageInfoTimeout));sj_evt.bind("ClientInst.PageInstInfo",function(t){n&&(sb_ct(n),n=null);o=t[1];o&&pt()})}function pt(){for(var n=0,t,i;ft.length>0;){try{i=ft.shift();t=JSON.parse(i)}catch(r){n++;continue}o&&o(t.data);w(t)}n>0&&f("InvalidIncompleteImpressions",n,_G.IG)}function w(n){r.append(n);l()}function a(n){return JSON.stringify(n).replace(/]]>/g,"]]]\]><![CDATA[>")}function ci(n,t,i){var f,u,r;t.push("<E>","<T>Event.",n.data.eventType,"<\/T>","<IG>",n.impressionGuid,"<\/IG>");n.previousImpressionGuid&&t.push("<PrevIG>",n.previousImpressionGuid,"<\/PrevIG>");n.dominantImpressionGuid&&n.previousImpressionGuid&&t.push("<DominantIG>",n.dominantImpressionGuid,"<\/DominantIG>");f=n.data.dataSources;f&&t.push("<DS><![CDATA[",a(f),"]\]><\/DS>");u=n.data.pageLayout;u&&b(u)&&t.push("<Page><L><![CDATA[",a(u),"]\]><\/L><\/Page>");r=n.data.eventData;r||(r=n.data.eventData={});r.UTS=i;t.push("<D><![CDATA[",a(r),"]\]><\/D>","<TS>",n.timestamp,"<\/TS>","<\/E>")}function b(n){var t=!1,i;try{n instanceof Array?t=n.every(b):(t=!!n.T,i=n.L,t&&i&&(t=b(i)))}catch(r){return SharedLogHelper.LogWarning("PageLayoutValidationException",null,r),!1}return t||SharedLogHelper.LogWarning("PageLayoutValidationException",JSON?JSON.stringify(n):n,null),t}function k(n,t,i){n.push('<requestInfo key="',t,'" value="',i,'"/>')}function li(n,t,i){function f(n){return n?n.replace(/&/g,"&amp;").replace(/"/g,"&quot;"):""}var r=n.data,e,u,c,o,s,h;t.push("<Group>","<M>","<IG>",n.impressionGuid,"<\/IG>","<DS><![CDATA[",a(r.dataSources),"]\]><\/DS>");e=r.enrichedClientInfo;e||(e={});e.ImpressionUrl=r.impressionUrl;_G.AppVer&&(e.ResourcesVersion=_G.AppVer);u=n.data.eventData;u||(u=n.data.eventData={});u.EnrichedClientInfo=e;u.TS=r.clientTimestamp;u.UTS=i;c=r.uxClassification;c&&(u.UxClassification=c);_w.sj_cook&&sj_cook.parse&&(u.Cookies=sj_cook.parse());t.push("<D><![CDATA[",a(u),"]\]><\/D>");t.push("<Page>","<Name>",r.pageName,"<\/Name>");o=r.layoutNodes;o&&b(o)&&t.push("<L><![CDATA[",a(o),"]\]><\/L>");t.push("<\/Page>","<TS>",n.timestamp,"<\/TS>","<Ovr>");k(t,"RawQuery",f(r.rawQuery));k(t,"IsQuery",f(r.isQuery.toString()));k(t,"Form",f(r.form));s=r.userInfoOverrides;for(h in s)s.hasOwnProperty(h)&&k(t,f(h),f(s[h]));t.push('<userInfo key="AppName" value="',f(r.appName),'"/>',"<\/Ovr>","<\/M>","<\/Group>")}function d(n){var t=window.location.href,i,r,u;return v&&t.indexOf(v)===0||(i=t.indexOf("?"),i<0&&(i=t.indexOf("#")),v=i<0?t:t.substring(0,i),r=_w.ThresholdUtilities,r&&(u=r.getUrlParameter(t,"FORM"),u&&(v+="?FORM="+u))),n.CurUrl=v,n.Pivot=_G.PN,typeof ThresholdUtilities!="undefined"&&_w.SearchAppWrapper&&_w.SearchAppWrapper.CortanaApp&&ThresholdUtilities.getCortanaHeaders(function(t){if(t){var i;(i=t["X-BM-ClientFeatures"])&&(n.CF=i);(i=t["X-BM-FlightedFeatures"])&&(n.FF=i)}}),n}function et(n,t){var r=["<ClientInstRequest>"],u=(new Date).getTime(),f=_G.CID||sj_cook.get(lt,lt),e,i,o;if(f&&r.push("<CID>",f,"<\/CID>"),n.length>0){for(r.push("<Events>"),i=0;i<n.length;i++)e=n[i],ci(e,r,u);r.push("<\/Events>")}if(t.length>0)for(i=0;i<t.length;i++)o=t[i],li(o,r,u);return r.push("<\/ClientInstRequest>"),r.join("")}function l(n,t){if(n===void 0&&(n=!1),t===void 0&&(t=!0),i.isInstrumentationEnabled){var r=n?c.retryQueue:c.mainQueue;!r.flushTimeoutHandle&&typeof tt!="undefined"&&tt.setTimeout&&(r.flushTimeoutHandle=tt.setTimeout(function(){return wt(n,r,!1,t)},r.getInterval()))}}function wt(n,t,u,o,s){var it,v,h,p,g,w,b,nt,k,y,d,rt,a,tt;if((o===void 0&&(o=!0),i.isInstrumentationEnabled)&&(sb_ct(t.flushTimeoutHandle),t.flushTimeoutHandle=null,!n||!c.mainQueue.inProgressUpload)){if(!n&&c.retryQueue.inProgressUpload&&c.retryQueue.inProgressUpload.abort(),t.inProgressUpload)if(it=(new Date).getTime()-t.requestSentTimestamp,u||it>i.flushInterval)t.inProgressUpload.abort(),u?f("SendAbortedForceFlush",1,_G.IG):f("SendTimedOut",1,_G.IG);else return;if(v=r.getBatch(n),v.length!=0){for(h={},p=0;p<v.events.length;p++)g=v.events[p],w=g.flights,h[w]||(h[w]={events:[],mpis:[]}),h[w].events.push(g.log);for(b=0;b<v.masterPageImpressions.length;b++)nt=v.masterPageImpressions[b],k=nt.flights,h[k]||(h[k]={events:[],mpis:[]}),h[k].mpis.push(nt.log);for(y in h){if(d=et(h[y].events,h[y].mpis),rt=s&&s.useSendBeacon||!1,(rt||ii())&&ri(_G.XLS,d)){r.clearSentItems(n)&&!n&&l(!1,s);l(!0,s);continue}a=sj_gx();a.open("POST",_G.XLS,o);tt=sj_df(ai,a,t,n);o&&(i.flushInterval>=1e3&&(a.timeout=i.flushInterval),a.onload=tt);a.setRequestHeader("Content-type","text/xml");y!==""&&(a.setRequestHeader("X-MSEdge-ExternalExpType","JointCoord"),a.setRequestHeader("X-MSEdge-ExternalExp",y));t.inProgressUpload=a;t.requestSentTimestamp=(new Date).getTime();a.send(d);o||tt(null)}}}}function ai(n,t,i,u){if(t.readyState===4){i.inProgressUpload=null;var f=Math.floor(t.status/100);f===2?(r.clearSentItems(u)&&!u&&l(!1),l(!0)):f===4?(r.markFailedItems(!0,u),l(!0)):r.markFailedItems(!1,u);u&&r.recordRetryAttempt()}}function bt(n,t,i){n===void 0&&(n=!1);t===void 0&&(t=!0);wt(!1,c.mainQueue,n,t,i)}function ot(n,t,i,r,u,f,e,o,h){var c={},l,a;if(d(c),t)if(typeof t=="string")c.Text=t;else for(l in t)t.hasOwnProperty(l)&&(c[l]=t[l]);return i&&(c.T="CI."+i),a=h||(new Date).getTime(),c.TS=a,c.RTS=a-p,c.SEQ=ut++,{type:s.EVENT,impressionGuid:f!=null?f:_G.IG,previousImpressionGuid:e,timestamp:a,data:{eventType:n,eventData:c,dataSources:r,pageLayout:u},dominantImpressionGuid:o}}function kt(n){var i=et(n,[]),t;ht(i)||(t=sj_gx(),t.open("POST",_G.XLS),t.setRequestHeader("Content-type","text/xml"),t.send(i))}function st(n,t,r,u,f,e,o,s,h){var c,l,a;if(EventsToDuplicate&&n==="Click"&&EventsToDuplicate.indexOf("duplicateClickOnLs")>=0&&(c=_G.gpUrl+"IG="+_G.IG+"&ID="+t.AppNS+","+t.K,ht("",c)||(_G.GPImg=new Image,_G.GPImg.src=c),n="XlsDelayedClick"),!_G.XLS)throw new Error("_G.XLS is necessary for clientinst_xls, but it is not defined");i.isInstrumentationEnabled&&(l=ot(n,t,r,u,f,e,o,s,h),EventsToDuplicate&&(EventsToDuplicate.indexOf("ALL")>=0||EventsToDuplicate.indexOf(n)>=0)&&(a=ot("Immediate"+n,t,r,u,f,e,o,s,h),kt([a])),w(l))}function dt(n){var t,r,u;i.isInstrumentationEnabled&&(o&&o(n),n.clientTimestamp||(n.clientTimestamp=(new Date).getTime()),t=n.eventData,t||(t=n.eventData={}),d(t),r={type:s.MASTER_PAGE_IMPRESSION,impressionGuid:n.impressionGuid?n.impressionGuid:_G.IG,previousImpressionGuid:null,timestamp:n.clientTimestamp,data:n},EventsToDuplicate&&(EventsToDuplicate.indexOf("ALL")>=0||EventsToDuplicate.indexOf("masterPageImpression")>=0)&&(u=ot("ImmediateMaster",t,n.impressionUrl,n.dataSources,n.layoutNodes,n.impressionGuid,null,null),kt([u])),o||!i.waitForPageInfo?w(r):ft.push(JSON.stringify(r)))}function ii(){return _G!==undefined&&_G.EF!==undefined&&_G.EF.logsb!==undefined&&_G.EF.logsb===1}function ht(n,t){return(t===void 0&&(t=_G.XLS),!ii())?!1:ri(t,n)}function ri(n,t){var i="sendBeacon",r=!1;if(navigator&&navigator[i])try{r=navigator[i](n,t)}catch(u){}return r}function ui(n,t){n===void 0&&(n=!0);r.dumpToStorage();bt(!0,n,t)}function nt(){r.dumpToStorage();bt(!1)}function fi(){r.dumpToStorage(!0)}function ct(){r.dumpToStorage()}function ei(){y=null;_CachedFlights=undefined}var r,c,gt,ni,ti,g;t.__esModule=!0;t.ResetState=t.SaveLogsToLocalStorage=t.SaveLogsToSharedStorage=t.FlushMainQueueDontForce=t.ForceFlush=t.Log2=t.LogInstrumented=t.Log=t.LogMasterPageImpression=t.LogEvent=void 0;var tt=n("env"),it=n("event.native"),h=n("event.custom"),e="Shared",s;(function(n){n[n.EVENT=0]="EVENT";n[n.MASTER_PAGE_IMPRESSION=1]="MASTER_PAGE_IMPRESSION"})(s||(s={}));var lt="MUID",y=null,rt="CIQueueError",i,oi=864e5,ut,p,u,ft=[],o,v,at,vt=0;(function(n){function k(){return c&&i.isInstrumentationEnabled}function d(n){var i,t;if(n===void 0&&(n=!1),k()){i=ct(n);try{t=n?v:h;u[t]=i;u[t+"_logUploadIntervalStartDate"]=o;u[t+"_uploadedLogSizeInInterval"]=r}catch(f){if(f.name.toLowerCase().indexOf("quota")>=0)c=!1;else throw f;}}}function p(){k()&&(a&&sb_ct(a),a=sb_st(d,i.queueDumpInterval))}function tt(n,t){var i=JSON.stringify(n),r=i.length+3;return n.size=r,t?i.replace('"size":0','"size":'+r):i}function it(n){return y===null&&typeof _CachedFlights!="undefined"&&_CachedFlights.sort&&(y=_CachedFlights.sort().join(",")),{log:n,lastSendErrorTimeStamp:0,inProgress:!1,size:0,flights:y}}function ut(){var n,r,i;if(u){if(at(),n=u[h],t=[],typeof n=="string"||n&&n.length!==0)try{if(t=JSON.parse(n),t.some(function(n){return!n.log}))f("PrimaryQueueRestoreInvalidItems",t.length,_G.IG),t=[];else if(r=t.length,r>0){for(i=0;i<r;i++)t[i].inProgress=!1;l()}}catch(e){f("PrimaryQueueRestoreFailed",0,_G.IG)}u[h]="[]";c=!0}}function ft(n){var a=[],y=[],o=n?e[0]:t,c,h,p,w,l,r,b;if(nt){if(c=u[v],typeof c=="string"&&c.length!==0)try{h=JSON.parse(c);h.some(function(n){return!n.log})?f("SharedQueueRestoreInvalidItems",h.length,_G.IG):o?Array.prototype.push.apply(o,h):o=h}catch(k){f("SharedQueueRestoreFailed",0,_G.IG)}u[v]="[]"}if(o)for(p=0,w=o.length,l=0;l<w;l++)if(r=o[l],n||!r.lastSendErrorTimeStamp)if(p+=r.size,p<=i.maxBatchSize)r.inProgress=!0,b=r.log,b.type==s.MASTER_PAGE_IMPRESSION?y.push(r):a.push(r);else break;return{events:a,masterPageImpressions:y,length:a.length+y.length,isRetryBatch:n}}function et(n){return t=t.filter(function(t){return!t.inProgress&&(!n||!!t.lastSendErrorTimeStamp)}),p(),t.length>0}function ot(n){return n.log.type===s.EVENT&&n.log.data&&n.log.data.eventType===rt}function st(n,i){for(var u=[],h=i?e[0]:t,o=0,r,s,c;o<h.length;)r=h[o],r.inProgress?n?(h.splice(o,1),ot(r)||(r.lastSendErrorTimeStamp=(new Date).getTime(),u.push(r))):(r.inProgress=!1,o++):o++;s=u.length;s==1?f("InvalidLogMessage",1,u[0].log.impressionGuid):s>0&&(c=s/2,e.push(u.slice(0,c)),e.push(u.slice(c)));p()}function ht(){var n,t,i;if(e.length>0){for(n=e[0],t=0;t<n.length;)i=n[t],i.inProgress?n.splice(t,1):t++;n.length==0&&e.shift()}}function ct(n){var c=JSON.stringify(t),e=c.length-i.maxStorageUse,o=t.length,u,r,s,h;if(e>0)for(u=0,r=0;r<o;r++)if(s=t[r].size,u+=s+1,u>=e){t.splice(0,r+1);f("QueueOverflow",r+1,_G.IG,!0);break}return h=JSON.stringify(t),n&&t.splice(0,o),h}function lt(n){var i=it(n);tt(i,!1);vt(i.size)&&t.push(i);p()}function at(){var t=h+"_logUploadIntervalStartDate",f=h+"_uploadedLogSizeInInterval",n;o=u[t];r=u[f];n=sb_gt();o==undefined||r==undefined?w(n):g(o,n)>=i.logUploadCapIntervalInDays&&w(n)}function w(n){o=n;r=0}function g(n,t){var i=t-n;return i/oi}function vt(n){var t,u;return i.isInstrumentationEnabled?LogUploadCapFeatureEnabled?(t=sb_gt(),g(o,t)>=i.logUploadCapIntervalInDays&&w(t),r>=i.logUploadCapSizeInChar)?!1:(u=r+n,u>=i.logUploadCapSizeInChar)?(f("LogUploadSizeLimitReached",1,_G.IG,!0),r=i.logUploadCapSizeInChar,!1):(r=u,!0):!0:!1}var t=[],o,r,c=!1,a=null,e=[],b=_w.location.pathname,h=InstLogQueueKeyFetcher.Get(b),v=InstLogQueueKeyFetcher.GetSharedLocation(),nt=InstLogQueueKeyFetcher.CanUploadSharedMessages(b);n.dumpToStorage=d;n.initialize=ut;n.getBatch=ft;n.clearSentItems=et;n.markFailedItems=st;n.recordRetryAttempt=ht;n.append=lt})(r||(r={}));c={mainQueue:{getInterval:function(){return i.flushInterval}},retryQueue:{getInterval:function(){return i.retryInterval}}};t.LogEvent=st;t.LogMasterPageImpression=dt;gt=function(n,t,r,u){for(var e=[],f=4;f<arguments.length;f++)e[f-4]=arguments[f];i.isInstrumentationEnabled&&(at||(g("Init","CI","Base"),at=!0),g(n,t,r,u,e))};t.Log=gt;ni=function(n,i,r,u,f,e,o){t.Log2(n,i!==null&&i!==void 0?i:r,null,null,u,f,o)};t.LogInstrumented=ni;ti=function(n,t,i,r,u,f,e){var o=Object.keys(e).reduce(function(n,t){return __spreadArray(__spreadArray([],n,!0),[t,e[t]],!1)},[]);i&&o.push("service",i);r&&o.push("scenario",r);u&&o.push("appNS",u);f&&o.push("kValue",f);g(n,null,t,!1,o)};t.Log2=ti;g=function(n,t,r,u,f){var a,e,c,l,o,h,v;if(i.isInstrumentationEnabled){if(a=_G.IG,e={},f&&f.length>0&&f.length%2==0)for(c=0;c<f.length;c+=2)(l=f[c],l)&&(o=l.toLowerCase(),h=f[c+1],o==="impressionguid"?a=h:o==="service"?e.Service=h:o==="scenario"?e.Scenario=h:o==="appns"?e.AppNS=h:o==="k"||o==="kvalue"?e.K=h:o==="pos"?e.Pos=h:e[l]=h);v=(new Date).getTime();e.T="CI.".concat(n);e.TS=v;e.RTS=v-p;e.SEQ=ut++;e.Name=r!==null&&r!==void 0?r:"";e.FID=typeof t!="number"?t!==null&&t!==void 0?t:"":"";e.hasOwnProperty("K")||typeof t!="number"||(e.K=t);d(e);w({type:s.EVENT,impressionGuid:a,previousImpressionGuid:null,timestamp:p,data:{eventType:"ClientInst",eventData:e}})}};t.ForceFlush=ui;hi();t.FlushMainQueueDontForce=nt;t.SaveLogsToSharedStorage=fi;t.SaveLogsToLocalStorage=ct;t.ResetState=ei;typeof h!="undefined"&&h.bind&&(h.bind("onP1",nt,!0),h.bind("ajax.postload",nt,!0));typeof it!="undefined"&&it.bind&&it.bind(_w,"beforeunload",ct,!1);_w.Log={Log:t.Log};_w.Log2={LogEvent:st,LogMasterPageImpression:dt,ForceFlush:ui,FlushMainQueueDontForce:nt,SaveLogsToSharedStorage:fi,ResetState:ei,SaveLogsToLocalStorage:ct};_w.Shared2=_w.Shared2||{};_w.Shared2.Log={Log:t.Log,LogInstrumented:t.LogInstrumented};_w.sj_log2=t.Log2})